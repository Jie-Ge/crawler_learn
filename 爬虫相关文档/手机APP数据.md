### 手机App爬虫归类
- 1、 50%的app，通过抓包软件就可以分析出抓取参数并抓取到信息。
- 2、 30%的app，可能需要适当的反编译，分析出加密算法并抓取到信息。
- 3、 10%的app，可能加固，需要脱壳，然后反编译，分析出加密算法并抓取到信息
- 4、 10%的app，通过各式各样的签名，证书，设备绑定等方法，隐藏加密算法。

### 抓包
- 抓包是爬虫里面经常用到的一个词，完整的应该叫做抓取 数据请求响应包

## 一、抓包工具
- Fiddler与Charles 功能大同小异，基本上都是抓包、断点调试、请求替换、构造请求、代理功能
- mitmproxy跟Fiddler和Charles最大的不同就是，mitmproxy可以进行二次开发

### 1、Fiddler
- Fiddler 运行在Windows平台
- Fiddler 是一款开源免费抓包工具
- 功能大同小异，基本上都是抓包、断点调试、请求替换、构造请求、代理功能

### 2、Charles
- Charles 是基于Java实现的，基本上可以运行在所有主流的桌面系统
- Charles 是一款收费的抓包工具，但是支持破解
#### 2.1、安装
- 按照网上的方法就行
- 若手机上无法下载证书，可在电脑浏览器访问下载地址 chl.pro/ssl , 然后将证书传给手机，再安装,  
  手机若提示 '无法安装CA证书' ，可到手机 '设置' --> '安全与隐私' 中找到 '从存储中安装'，即可安装CA,  
  安装好后 charles 上会弹框，然后选择 'allow'
#### 2.2、使用
- 1）请求响应拦截
  - `Proxy` -> `macOS Proxy`  勾选则拦截电脑上的包，取消则不拦截
- 2）断点的使用
  - 作用：拦截请求或者响应包并暂停，此时可以修改请求或者返回的参数
  - 这个功能还是比较实用的，这样就可以省掉一些服务需要的配合，自己可以通过修改数据来模拟不同的情况
  
- 3）重定向（`Map Remote`）
- 4）加载本地数据（`Map Local`）
  - 加载本地的模拟数据来开发测试
  
### 3、mitmproxy
- 简介： mitmproxy 就是用于MITM的proxy, MITM即中间人攻击。说白了就是服务器和客户机中间通讯多增加了一层，会适时的查、记录其截获的数据，或篡改数据。
  跟Fiddler和Charles最大的不同就是，mitmproxy可以进行二次开发，尤其可以对接python。  
  **【举例来说，利用 fiddler 可以过滤出浏览器对某个特定 url 的请求，并查看、分析其数据，但实现不了高度定制化的需求，
  类似于：“截获对浏览器对该 url 的请求，将返回内容置空，并将真实的返回内容存到某个数据库，出现异常时发出邮件通知”，
  而对于 mitmproxy，这样的需求可以通过载入自定义 python 脚本轻松实现】**
  
- 由于 mitmproxy 工作在 HTTP 层，而当前 HTTPS 的普及让客户端拥有了检测并规避中间人攻击的能力，
  所以要让 mitmproxy 能够正常工作，必须要让客户端（APP 或浏览器）主动信任 mitmproxy 的 SSL 证书，或忽略证书异常，
  这也就意味着 APP 或浏览器是属于开发者本人的
  
- 实际意义：据我所知目前比较广泛的应用是做仿真爬虫，即利用手机模拟器、无头浏览器来爬取 APP 或网站的数据，
  mitmpproxy 作为代理可以拦截、存储爬虫获取到的数据，或修改数据调整爬虫的行为
  
#### 3.1 安装
- `pip install mitmproxy` 完成后，系统将拥有 mitmproxy、mitmdump、mitmweb 三个命令
- 要启动 mitmproxy 用 `mitmproxy`、`mitmdump`、`mitmweb` 这三个命令中的任意一个即可，这三个命令功能一致，且都可以加载自定义脚本，唯一的区别是交互界面的不同
- `mitmproxy`    
  mitmproxy 命令启动后，会提供一个命令行界面，用户可以实时看到发生的请求，并通过命令过滤请求，查看请求数据。
  mitmproxy 命令不支持在 windows 系统中运行
  
- `mitmweb`  
  mitmweb 命令启动后，会提供一个 web 界面，用户可以实时看到发生的请求，并通过 GUI 交互来过滤请求，查看请求数据。
  
- `mitmdump`  
  mitmdump 命令启动后——你应该猜到了，没有界面，程序默默运行，所以 mitmdump 无法提供过滤请求、查看数据的功能，只能结合自定义脚本，默默工作
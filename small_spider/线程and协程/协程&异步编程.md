## 1 协程
- 协程不是计算机提供，程序员人为创造
- 协程，也可称为微线程，就是通过一个线程实现代码块相互切换执行
- 实现协程的几种方法：
    - greenlet, 早期模块
    - yield关键字
    - asyncio装饰器（py3.4）
    - async, await关键字（py3.5）【推荐】
- 怎么使用：在需要等待的语句前加上异步关键字  
- 协程意义：在一个线程中如果遇到io等待，线程不会傻傻等待，会执行下一个任务【异步】

## 2 异步编程
- 【异步】：在一个线程中如果遇到io等待，线程不会傻傻等待，会执行下一个任务
### 2.1 快速上手
- 协程函数：`async def 函数名`
- 协程对象：执行协程函数得到的协程对象
```python
import asyncio
async def func():
  print("我被执行了！！！")

result = func()  # 创建协程对象，函数内部代码不会执行

# # 生成或获取一个事件循环
# loop = asyncio.get_event_loop()
# # 循环执行任务
# loop.run_until_complete(result)
# 上面两句等价于下面的执行语句
asyncio.run(result)  # python3.7
```
    
### 2.2 await
- await + 可等待的对象（协程对象、Future、Task对象）
- 等待执行完之后再继续往下走
```python
import asyncio

async def others():
  print('start......')
  await asyncio.sleep(2)
  print('end')
  return '返回值'

async def func():
    print('func()......')
    # 此示例中，需等待执行完后才会继续执行后面的代码，非异步 【与下一段的代码区分】
    response1 = await others()  
    print(response1)
    response2 = await others()
    print(response2)
    
asyncio.run(func())
```

### 2.3 Task
- 在事件循环中添加多个任务
- 通过 `asyncio.create_task(协程对象)` 的方式创建Task对象，还可以用低层级的`loop.create_task()`或者`asyncio.ensure_future()`
- 【注意】`asyncio.create_task(协程对象)`是在python3.7中加入的
```python
import asyncio

async def others():
  print('start......')
  await asyncio.sleep(2)
  print('end')
  return '返回值'

async def func():
    print('func()......')
    # 创建了两个任务
    task1 = asyncio.create_task(others())
    task2 = asyncio.create_task(others())
    
    # 此实例中，因为有两个任务，所以 await task1 遇到io等待时，会切换到执行 await task2 【与上一段的代码区分】
    ret1 = await task1
    ret2 = await task2
    
asyncio.run(func())
```

实际中应该这样写：
```python
import asyncio

async def others():
  print('start......')
  await asyncio.sleep(2)
  print('end')
  return '返回值'

async def func():
    print('func()......')
    # 创建任务列表
    task_list = [
        asyncio.create_task(others(), name='n1'),
        asyncio.create_task(others(), name='n2')
    ]
    # done存储所有的任务相关信息，pending没啥用
    done, pending = await asyncio.wait(task_list)
    
asyncio.run(func())
```

若任务没有在协程函数里面，应该这样写：
```python
import asyncio

async def others():
  print('start......')
  await asyncio.sleep(2)
  print('end')
  return '返回值'


task_list = [
    others(),
    others()
]
# done存储所有的任务相关信息，pending没啥用
done, pending = asyncio.run( asyncio.wait(task_list) )

```